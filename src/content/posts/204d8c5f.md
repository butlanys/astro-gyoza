---
title: cloudflare tunnelä¼˜é€‰IP
date: 2024-05-14 19:51:51+08:00
lastMod: 2025-01-14 16:18:17+08:00
summary: ThisÂ tutorialÂ explainsÂ howÂ toÂ useÂ CloudflareÂ TunnelÂ toÂ accessÂ servicesÂ hostedÂ onÂ aÂ localÂ serverÂ whileÂ bypassingÂ Cloudflare'sÂ defaultÂ USÂ IPÂ allocationÂ andÂ potentialÂ GFWÂ blocking.Â Â ItÂ requiresÂ aÂ Mastercard/VisaÂ cardÂ forÂ CloudflareÂ forÂ SaaSÂ andÂ twoÂ domains:Â oneÂ forÂ routingÂ optimizedÂ trafficÂ andÂ anotherÂ managedÂ byÂ Cloudflare.Â TheÂ tutorialÂ detailsÂ settingÂ upÂ `cloudflared`Â (includingÂ DockerÂ deployment),Â creatingÂ aÂ tunnel,Â configuringÂ DNSÂ routing,Â andÂ testingÂ theÂ connection.Â Finally,Â itÂ coversÂ settingÂ upÂ CloudflareÂ forÂ SaaSÂ withÂ aÂ fallbackÂ domainÂ andÂ customÂ hostname,Â andÂ usingÂ aÂ third-partyÂ toolÂ toÂ identifyÂ optimalÂ CloudflareÂ IPsÂ forÂ improvedÂ performance.Â TheÂ ultimateÂ goalÂ isÂ toÂ achieveÂ fasterÂ andÂ moreÂ reliableÂ accessÂ toÂ locallyÂ hostedÂ servicesÂ throughÂ Cloudflare.
category: cloudflare
tags: []
sticky: 0
---

**æ€»æ‰€å‘¨çŸ¥ï¼Œcloudflareé»˜è®¤åˆ†é…çš„IPéƒ½åœ¨ç¾å›½ï¼Œè½»åˆ™é€Ÿåº¦æ…¢è¿æ°”ä¸å¥½åˆ†é…çš„è¿˜æ˜¯è¢«GFWæ‹¦æˆªçš„**

æœ¬æ•™ç¨‹éœ€è¦ï¼š

ä¸€å¼ ä¸‡äº‹è¾¾/visaè¿‡cloudflare for saaséªŒè¯

ä¸¤æ¡åŸŸåï¼Œä¸€æ¡ç”¨äºä¼˜é€‰ï¼Œä¸€æ¡æ‰˜ç®¡åˆ°cloudfalre

#### ä¸€ã€é…ç½®cloudflared

* cloudflaredå¯åœ¨[cloudflare/cloudflared: Cloudflare Tunnel client (formerly Argo Tunnel) (github.com)](https://github.com/cloudflare/cloudflared/)ä¸Šè·å–

##### éƒ¨ç½²æ–¹å¼ï¼ˆå¯é€‰ï¼‰

* æœ¬æ•™ç¨‹ä»¥dockerä¸ºä¾‹

```
docker run -d --name cloudflared_status --network=host alpine sleep infinity
```

##### ä¸‹è½½cloudflared

è¿™é‡Œä»¥arm64ä¸ºä¾‹

```
wget -O /usr/bin/cloudflared https://github.hqycloud.top/https://github.com/cloudflare/cloudflared/releases/download/2024.4.1/cloudflared-linux-arm64
```

##### è®¾ç½®æƒé™

```
chmod 777 /usr/bin/cloudflared
```

##### æŸ¥çœ‹ç‰ˆæœ¬å·

```
cloudflared version
```

##### ç™»å½•cloudflared

```
cloudflared tunnel login
```

##### åˆ›å»ºéš§é“å¹¶å‘½å

```
cloudflared tunnel create éš§é“å
```

* éš§é“åå¯ä»¥è‡ªå®šä¹‰ï¼Œä½†ä¸èƒ½é‡å¤ï¼

##### æŸ¥çœ‹éš§é“åˆ—è¡¨

```
cloudflared tunnel list
```

##### åˆ›å»ºé…ç½®æ–‡ä»¶

```
echo 'url: http://localhost:8000
tunnel: <Tunnel-UUID>
credentials-file: /root/.cloudflared/<Tunnel-UUID>.json' > .cloudflared/config.yml
```

è¿™é‡Œçš„Tunnel-UUIDåœ¨éš§é“åˆ—è¡¨å¯ä»¥çœ‹åˆ°

*æŸ¥çœ‹åˆ›å»ºå¥½çš„config.yml*

```
cat config.yml
```

##### è®¾ç½®åŸŸå

```
cloudflared tunnel route dns <UUID or NAME> <hostname>
```

UUIDå’ŒNAMEäºŒé€‰ä¸€ï¼ŒuuidæŸ¥çœ‹éš§é“åˆ—è¡¨å°±èƒ½çœ‹åˆ°ï¼Œnameæ˜¯ä½ åˆ›å»ºæ—¶è¾“å…¥çš„åå­—

hostnameå¡«çš„æ˜¯æ‰˜ç®¡åœ¨cloudflareçš„å­åŸŸï¼Œä¸éœ€è¦å®Œæ•´çš„åŸŸå

ä¾‹å¦‚ï¼štunnel-cdn.test.comï¼ˆæ‰˜ç®¡åœ¨cloudflare

åˆ™åªéœ€è¦å¡«tunnel-cdn

##### æµ‹è¯•éš§é“æ˜¯å¦æ­£å¸¸

```
cloudflared tunnel run <UUID or NAME>
```

è®¿é—®æ‰˜ç®¡åœ¨cloudflareçš„éš§é“å­åŸŸæŸ¥çœ‹æ˜¯å¦æ­£å¸¸

å¦‚æœæ­£å¸¸å¯ç»§ç»­çœ‹ä¸‹ä¸€æ­¥ï¼Œå¦‚æœæ‰“ä¸å¼€å¹¶æŠ¥é”™ï¼Œè¯·ç§»æ­¥è‡³cloudflareæ–‡æ¡£

##### åœ¨åå°è¿è¡Œéš§é“

```
nohup cloudflared tunnel run <UUID or NAME> &
```

#### äºŒã€é…ç½®ä¼˜é€‰IP

##### å¼€é€šcloudflare for saasæœåŠ¡

éœ€è¦ç»‘å¡ï¼Œè¿™é‡Œä¸è¿‡å¤šèµ˜è¿°

##### è®¾ç½®å›é€€åŸŸ

![https://github.hqycloud.top/https://raw.githubusercontent.com/hqycloud/blog-images/main/hexo-images/24/5/image_01ef7296fe69d35d4ec735ff7050b501.png](https://github.hqycloud.top/https://raw.githubusercontent.com/hqycloud/blog-images/main/hexo-images/24/5/image_01ef7296fe69d35d4ec735ff7050b501.png)

å›é€€åŸŸå¿…é¡»è®¾ç½®ä¸ºä¸éš§é“ç»‘å®šçš„åŸŸå

##### è®¾ç½®è®¿é—®åŸŸå

æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰ä¸»æœºå

åŸŸåå¡«å…¬å¼€è®¿é—®çš„åŸŸåï¼ˆå¿…é¡»æ‰˜ç®¡åœ¨å…¶ä»–dnsæœåŠ¡å•†ï¼Œå¦åˆ™cloudflareä¼šæ£€æµ‹

éªŒè¯æ–¹å¼é€‰TXT

#### å®Œæˆ

åœ¨éªŒè¯è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æŠŠè§£æè®¾ä¸ºå›é€€åŸŸï¼Œå¦åˆ™éªŒè¯ä¸é€šè¿‡

ç­‰å¾…è¯ä¹¦çŠ¶æ€å’Œä¸»æœºåçŠ¶æ€éƒ½æ˜¾ç¤ºæœ‰æ•ˆåè®¿é—®ä¸€ä¸‹è¯•è¯•

è®¿é—®æˆåŠŸåå°±å¯ä»¥æŠŠè§£æè®¾ç½®ä¸ºcfçš„ä»»æ„IP

* æ‰¾cloudflareé€Ÿåº¦å¿«çš„IPâ†’[XIU2/CloudflareSpeedTest: ğŸŒ©ã€Œè‡ªé€‰ä¼˜é€‰ IPã€æµ‹è¯• Cloudflare CDN å»¶è¿Ÿå’Œé€Ÿåº¦ï¼Œè·å–æœ€å¿« IP ï¼å½“ç„¶ä¹Ÿæ”¯æŒå…¶ä»– CDN / ç½‘ç«™ IP \~ (github.com)](https://github.com/XIU2/CloudflareSpeedTest)
